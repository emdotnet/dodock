image: "ubuntu:18.04"

variables:
  GIT_STRATEGY: none
  GIT_CHECKOUT: "false"

before_script:
  - apt-get update && apt-get -y install curl
  - apt-get update && apt-get install -y wget
  - apt-get update && apt-get install -y python3-minimal
  - apt-get update && apt-get install -y build-essential python-setuptools
  - adduser --disabled-password --gecos "" dokotest
  - usermod -aG sudo dokotest
  - wget https://gitlab.com/dokos/docli/raw/master/playbooks/install.py
  - python3 install.py --production --without-erpnext --user dokotest

stages:
  - Unit Tests

unittests:
  stage: Unit Tests
  script:
    - bench --site test_site reinstall --yes
    - bench --site test_site scheduler disable
    - bench --site test_site run-tests --coverage